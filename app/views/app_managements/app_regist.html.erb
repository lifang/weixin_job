<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src='/assets/mobilephone/jquery-1.8.3.js' type='text/javascript'></script>
    <link href='/assets/style2.css' rel='stylesheet' type='text/css' />
    <title>用户登记</title>
  </head>
  <body>
    <div class='form_list'>
      <%= form_tag :url => "/companies/#{@company.id}/app_managements/get_form_date", :method => "post" do |f|%>
        <%= raw @ele %>
        <p class='warn'>带*内容爲必填项目，请你务必完成填写。对于你所填写的所有信息，我们将严格保密。</p>
        <div class='form_btn'><button type='button' onclick='submit_form(this)'>确认提交</button></div>
      <% end %>
    </div>

    <script>

      var href = window.location.href;
      var arr = href.split('?secret_key=');
      var secret_key = arr[1];

      function submit_form(obj){
        var input =$(obj).parents('form').find('input.client_required');
        name = $.trim(input.val());
        label = input.attr('data-name')
        if(name==''){
          alert(label + '不能为空！');
          return false;
        }

        var str = $(obj).parents('form').serialize();
        if(secret_key != 'undefined' && $.trim(secret_key) != ''){
          str = str + '&open_id='+secret_key;
        }
        $.ajax({
          async : true,
          type : 'post',
          url : '/companies/<%= @company.id %>/app_managements/get_form_date',
          dataType : 'text',
          data : str,
          success : function(data) {
            if(data==1)
              window.location.replace('/submit_redirect');
            else if(data==2)
              window.location.replace('/submit_redirect');
            else if(data==3)
              alert('缺少参数!')
            else
              alert('error');
          }
        });

      }
    </script>
   
  </body>
</html>